<ng-template #header>
  <div class="header">
    @if (noiSubmission) {
      <h6>Notice of Intent ID: {{ noiSubmission.fileNumber }} | {{ noiSubmission.type }}</h6>
    }
    <div class="header-btn-wrapper">
      @if (noiSubmission?.fileNumber && cdkStepper.selectedIndex === steps.ReviewAndSubmit) {
        <button
          mat-flat-button
          color="primary"
          (click)="onDownloadPdf(noiSubmission?.fileNumber)"
          >
          Download PDF
        </button>
      }
      <div class="change-app-type-btn-wrapper">
        <button mat-flat-button color="accent" (click)="onChangeSubmissionType()">Change NOI Type</button>
        <mat-icon
          color="accent"
          matTooltip="Changing application type will remove some inputs from your saved progress"
          >
          help_outline
        </mat-icon>
      </div>
    </div>
  </div>
</ng-template>

<app-custom-stepper
  class="edit-application"
  #cdkStepper
  (selectionChange)="onStepChange()"
  (beforeSwitchStep)="switchStep($event)"
  >
  <cdk-step label="Parcel Details">
    <ng-container *ngTemplateOutlet="header"></ng-container>
    @if (cdkStepper.selectedIndex === steps.Parcel) {
      <div>
        <app-noi-parcel-details
          [$noiSubmission]="$noiSubmission"
          [showErrors]="showValidationErrors"
          (navigateToStep)="switchStep($event)"
          (componentInitialized)="onParcelDetailsInitialized()"
          (exit)="onExit()"
        ></app-noi-parcel-details>
      </div>
    }
  </cdk-step>
  <cdk-step label="Primary Contact">
    <ng-container *ngTemplateOutlet="header"></ng-container>
    @if (cdkStepper.selectedIndex === steps.PrimaryContact) {
      <div>
        <app-primary-contact
          [showErrors]="showValidationErrors"
          [$noiSubmission]="$noiSubmission"
          [$noiDocuments]="$noiDocuments"
          (navigateToStep)="switchStep($event)"
          (exit)="onExit()"
        ></app-primary-contact>
      </div>
    }
  </cdk-step>
  <cdk-step label="Government">
    <ng-container *ngTemplateOutlet="header"></ng-container>
    @if (cdkStepper.selectedIndex === steps.Government) {
      <div>
        <app-select-government
          [showErrors]="showValidationErrors"
          [$noiSubmission]="$noiSubmission"
          (navigateToStep)="switchStep($event)"
          (exit)="onExit()"
        ></app-select-government>
      </div>
    }
  </cdk-step>
  <cdk-step label="Land Use">
    <ng-container *ngTemplateOutlet="header"></ng-container>
    @if (cdkStepper.selectedIndex === steps.LandUse) {
      <div>
        <app-land-use
          [$noiSubmission]="$noiSubmission"
          [showErrors]="showValidationErrors"
          (navigateToStep)="switchStep($event)"
          (exit)="onExit()"
        ></app-land-use>
      </div>
    }
  </cdk-step>
  <cdk-step label="Proposal">
    <ng-container *ngTemplateOutlet="header"></ng-container>
    @if (noiSubmission && cdkStepper.selectedIndex === steps.Proposal) {
      <div>
        @if (noiSubmission.typeCode === 'ROSO') {
          <app-roso-proposal
            [$noiSubmission]="$noiSubmission"
            [$noiDocuments]="$noiDocuments"
            [showErrors]="showValidationErrors"
            (navigateToStep)="switchStep($event)"
            (exit)="onExit()"
            >
          </app-roso-proposal>
        }
        @if (noiSubmission.typeCode === 'POFO') {
          <app-pofo-proposal
            [$noiSubmission]="$noiSubmission"
            [$noiDocuments]="$noiDocuments"
            [showErrors]="showValidationErrors"
            (navigateToStep)="switchStep($event)"
            (exit)="onExit()"
            >
          </app-pofo-proposal>
        }
        @if (noiSubmission.typeCode === 'PFRS') {
          <app-pfrs-proposal
            [$noiSubmission]="$noiSubmission"
            [$noiDocuments]="$noiDocuments"
            [showErrors]="showValidationErrors"
            (navigateToStep)="switchStep($event)"
            (exit)="onExit()"
            >
          </app-pfrs-proposal>
        }
      </div>
    }
  </cdk-step>
  <cdk-step label="Additional Information">
    <ng-container *ngTemplateOutlet="header"></ng-container>
    @if (noiSubmission && cdkStepper.selectedIndex === steps.ExtraInfo) {
      <div>
        <app-additional-information
          [$noiSubmission]="$noiSubmission"
          [$noiDocuments]="$noiDocuments"
          [showErrors]="showValidationErrors"
          (navigateToStep)="switchStep($event)"
          (exit)="onExit()"
        ></app-additional-information>
      </div>
    }
  </cdk-step>
  <cdk-step label="Upload Attachments">
    <ng-container *ngTemplateOutlet="header"></ng-container>
    @if (cdkStepper.selectedIndex === steps.Attachments) {
      <div>
        <app-other-attachments
          [$noiSubmission]="$noiSubmission"
          [$noiDocuments]="$noiDocuments"
          [showErrors]="showValidationErrors"
          (navigateToStep)="switchStep($event)"
          (exit)="onExit()"
        ></app-other-attachments>
      </div>
    }
  </cdk-step>
  <cdk-step label="Review & Submit">
    <ng-container *ngTemplateOutlet="header"></ng-container>
    @if (cdkStepper.selectedIndex === steps.ReviewAndSubmit) {
      <div>
        <app-review-and-submit
          [$noiSubmission]="$noiSubmission"
          [$noiDocuments]="$noiDocuments"
          (exit)="onExit()"
          (submit)="onSubmit()"
        ></app-review-and-submit>
      </div>
    }
  </cdk-step>
</app-custom-stepper>
