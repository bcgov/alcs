<div class="step-description">
  <h2>Proposal</h2>
  <p>
    Considerations are subject to
    <a> Section 6 of the ALC Act. </a>
  </p>
  <p>All fields are required unless stated optional.</p>
</div>
<app-warning-banner>
  In order to complete this step, please consult the following pages on the ALC website:
  <ul>
    <li>
      <a
        href="https://www.alc.gov.bc.ca/application-and-notice-process/applications/what-the-commission-considers/"
        target="_blank"
      >
        What the Commission Considers
      </a>
    </li>
    <li>
      <a href="TODO" target="_blank">FIXME: Removal of Soil</a>
    </li>
  </ul>
</app-warning-banner>
<form [formGroup]="form">
  <div class="form-row">
    <div class="full-row">
      <label for="noi-follow-up">
        Are you submitting this application as a follow-up to an ALC Notice of Intent (NOI)?
      </label>
      <div class="subtext">
        If yes, please provide your NOI ID in the field below. Only applicants who have submitted a NOI to the ALC will
        have a NOI ID.
      </div>
      <div>
        <mat-button-toggle-group
          class="input"
          (valueChange)="onChangeNOI($event)"
          id="noi-follow-up"
          formControlName="isNOIFollowUp"
        >
          <mat-button-toggle
            class="toggle-button"
            [ngClass]="{
              'error-outline': isNOIFollowUp.invalid && (isNOIFollowUp.dirty || isNOIFollowUp.touched)
            }"
            value="true"
            >Yes
          </mat-button-toggle>
          <mat-button-toggle
            class="toggle-button"
            [ngClass]="{
              'error-outline': isNOIFollowUp.invalid && (isNOIFollowUp.dirty || isNOIFollowUp.touched)
            }"
            value="false"
            >No
          </mat-button-toggle>
        </mat-button-toggle-group>
      </div>
    </div>
    <div class="full-row">
      <label for="NOIIDs">Notice of Intent (NOI) ID</label>
      <div class="subtext">If you have multiple NOI IDs, please separate with a comma.</div>
      <mat-form-field appearance="outline">
        <input type="text" formControlName="NOIIDs" id="NOIIDs" matInput />
      </mat-form-field>

      <div *ngIf="NOIIDs.invalid && (NOIIDs.dirty || NOIIDs.touched)" class="field-error">
        <mat-icon>warning</mat-icon>
        <div *ngIf="NOIIDs.errors?.['required']">This field is required</div>
      </div>
    </div>
    <div class="full-row">
      <label for="application-follow-up">Does this proposal have previous ALC authorization?</label>
      <div class="subtext">If yes, please provide the ALC Application ID in the field below.</div>
      <div>
        <mat-button-toggle-group
          class="input"
          (valueChange)="onChangeALCAuthorization($event)"
          id="application-follow-up"
          formControlName="hasALCAuthorization"
        >
          <mat-button-toggle
            class="toggle-button"
            [ngClass]="{
              'error-outline': hasALCAuthorization.invalid && (hasALCAuthorization.dirty || hasALCAuthorization.touched)
            }"
            value="true"
            >Yes
          </mat-button-toggle>
          <mat-button-toggle
            class="toggle-button"
            [ngClass]="{
              'error-outline': hasALCAuthorization.invalid && (hasALCAuthorization.dirty || hasALCAuthorization.touched)
            }"
            value="false"
            >No
          </mat-button-toggle>
        </mat-button-toggle-group>
      </div>
    </div>
    <div class="full-row">
      <label for="application-id">Application ID</label>
      <div class="subtext">If you have multiple Application IDs, please separate with a comma.</div>
      <mat-form-field appearance="outline">
        <input type="text" formControlName="applicationIDs" id="application-id" matInput />
      </mat-form-field>
      <div *ngIf="applicationIDs.invalid && (applicationIDs.dirty || applicationIDs.touched)" class="field-error">
        <mat-icon>warning</mat-icon>
        <div *ngIf="applicationIDs.errors?.['required']">This field is required</div>
      </div>
    </div>
    <div class="full-row">
      <label for="purpose">What is the purpose of the proposal?</label>
      <div class="subtext">
        Include why you are applying for removal of soil, what the proposal will achieve, and any benefits to
        agriculture that the proposal provides.
      </div>
      <mat-form-field appearance="outline">
        <textarea
          formControlName="purpose"
          #purposeText
          maxlength="4000"
          id="purpose"
          matInput
          placeholder="Type comment"
        ></textarea>
      </mat-form-field>
      <span class="subtext">Characters left: {{ 4000 - purposeText.textLength }}</span>
      <div *ngIf="purpose.invalid && (purpose.dirty || purpose.touched)" class="field-error">
        <mat-icon>warning</mat-icon>
        <div *ngIf="purpose.errors?.['required']">This field is required</div>
      </div>
    </div>
    <div class="full-row">
      <label>Proposal Dimensions</label>
      <div class="subtext">
        Please provide accurate numbers that align with your cross sections, reclamation plan, and site plan. The
        Commission will consider your proposal dimensions when determining the potential impact it will have on the
        agricultural capability of the land.
      </div>
      <app-info-banner>
        Please refer to <a href="TODO">Contact Us</a> on the ALC website for more detail.
      </app-info-banner>
      <app-soil-table
        *ngIf="!isMobile"
        tableHeader="Soil to be Removed"
        tableHeader2="Fill to be Placed"
        [(data)]="removalTableData"
        [(data2)]="fillTableData"
      ></app-soil-table>
      <app-soil-table *ngIf="isMobile" tableHeader="Soil to be Removed" [(data)]="removalTableData"></app-soil-table>
      <app-soil-table *ngIf="isMobile" tableHeader="Fill to be Placed" [(data)]="fillTableData"></app-soil-table>
    </div>
    <div class="full-row">
      <label
        >Of the proposed totals provided above, please input the dimensions of soil that has already been
        removed.</label
      >
      <div class="subtext">If no proposed soil has already been removed, please leave 0 in the fields below</div>
      <app-soil-table
        *ngIf="!isMobile"
        tableHeader="Soil already Removed"
        tableHeader2="Fill already Placed"
        [(data)]="alreadyRemovedTableData"
        [(data2)]="alreadyFilledTableData"
      ></app-soil-table>
      <app-soil-table
        *ngIf="isMobile"
        tableHeader="Soil already Removed"
        [(data)]="alreadyRemovedTableData"
      ></app-soil-table>
      <app-soil-table
        *ngIf="isMobile"
        tableHeader="Fill already Placed"
        [(data)]="alreadyFilledTableData"
      ></app-soil-table>
    </div>

    <section>
      <h4>Project Duration</h4>
      <div class="subtext">Estimated duration of the project</div>
      <div class="form-row">
        <div>
          <label for="projectDurationUnit">Duration</label>
          <mat-form-field appearance="outline">
            <mat-select placeholder="Select one" id="projectDurationUnit" formControlName="projectDurationUnit">
              <mat-option value="days">Days</mat-option>
              <mat-option value="months">Months</mat-option>
              <mat-option value="years">Years</mat-option>
            </mat-select>
          </mat-form-field>
          <div
            *ngIf="projectDurationUnit.invalid && (projectDurationUnit.dirty || projectDurationUnit.touched)"
            class="field-error"
          >
            <mat-icon>warning</mat-icon>
            <div *ngIf="projectDurationUnit.errors?.['required']">This field is required</div>
          </div>
        </div>
        <div>
          <label for="projectDurationAmount">Length</label>
          <mat-form-field appearance="outline">
            <input
              id="projectDurationAmount"
              mask="separator.2"
              thousandSeparator=","
              separatorLimit="9999999999"
              min="0.01"
              matInput
              formControlName="projectDurationAmount"
              placeholder="Type length as a decimal number"
            />
          </mat-form-field>
          <div
            *ngIf="projectDurationAmount.invalid && (projectDurationAmount.dirty || projectDurationAmount.touched)"
            class="field-error"
          >
            <mat-icon>warning</mat-icon>
            <div *ngIf="projectDurationAmount.errors?.['required']">This field is required</div>
          </div>
        </div>
      </div>
    </section>

    <div class="full-row">
      <label for="fillTypeToPlace">Describe the type, origin and quality of fill proposed to be placed.</label>
      <div class="subtext">
        List all proposed types of fill. Prohibited fill cannot be placed within the Agricultural Land Reserve.
      </div>
      <mat-form-field appearance="outline">
        <textarea
          formControlName="fillTypeToPlace"
          #fillTypeToPlaceText
          maxlength="4000"
          id="fillTypeToPlace"
          matInput
          placeholder="Type comment"
        ></textarea>
      </mat-form-field>
      <span class="subtext">Characters left: {{ 4000 - fillTypeToPlaceText.textLength }}</span>
      <div *ngIf="fillTypeToPlace.invalid && (fillTypeToPlace.dirty || fillTypeToPlace.touched)" class="field-error">
        <mat-icon>warning</mat-icon>
        <div *ngIf="fillTypeToPlace.errors?.['required']">This field is required</div>
      </div>
      <div class="subtext">Example: Aggregate, Extraction, Placer Mining, Peat Extraction, Soil etc.</div>
    </div>

    <div class="full-row">
      <label for="soilTypeRemoved">Describe the type of soil proposed to be removed.</label>
      <div class="subtext">List all proposed soil types to be removed.</div>
      <mat-form-field appearance="outline">
        <textarea
          formControlName="soilTypeRemoved"
          #soilTypeRemovedText
          maxlength="4000"
          id="soilTypeRemoved"
          matInput
          placeholder="Type comment"
        ></textarea>
      </mat-form-field>
      <span class="subtext">Characters left: {{ 4000 - soilTypeRemovedText.textLength }}</span>
      <div *ngIf="soilTypeRemoved.invalid && (soilTypeRemoved.dirty || soilTypeRemoved.touched)" class="field-error">
        <mat-icon>warning</mat-icon>
        <div *ngIf="soilTypeRemoved.errors?.['required']">This field is required</div>
      </div>
      <div class="subtext">Example: Aggregate, Extraction, Placer Mining, Peat Extraction, Soil etc.</div>
    </div>

    <div class="full-row">
      <label for="alternativeMeasures"
        >What alternative measures have you considered or attempted before proposing to place fill?</label
      >
      <div class="subtext">
        Applicants should provide evidence demonstrating that normal farm practices have been attempted prior to the
        submission of this application to place fill.
      </div>
      <mat-form-field appearance="outline">
        <textarea
          formControlName="alternativeMeasures"
          #soilAlternativeMeasuresText
          maxlength="4000"
          id="alternativeMeasures"
          matInput
          placeholder="Type comment"
        ></textarea>
      </mat-form-field>
      <span class="subtext">Characters left: {{ 4000 - soilAlternativeMeasuresText.textLength }}</span>
      <div
        *ngIf="alternativeMeasures.invalid && (alternativeMeasures.dirty || alternativeMeasures.touched)"
        class="field-error"
      >
        <mat-icon>warning</mat-icon>
        <div *ngIf="alternativeMeasures.errors?.['required']">This field is required</div>
      </div>
      <div class="subtext">Example: Aggregate, Extraction, Placer Mining, Peat Extraction, Soil etc.</div>
    </div>

    <div class="full-row">
      <label for="agricultural-support">
        What steps will be taken to reduce impacts to surrounding agricultural land?
        <div class="subtext">Describe impact reducing measures.</div>
      </label>
      <mat-form-field appearance="outline">
        <textarea
          [formControl]="reduceNegativeImpacts"
          #reduceNegativeImpactsText
          maxlength="4000"
          id="agricultural-support"
          matInput
          placeholder="Type comment"
        ></textarea>
      </mat-form-field>
      <span class="subtext">Characters left: {{ 4000 - reduceNegativeImpactsText.textLength }}</span>
      <div
        *ngIf="reduceNegativeImpacts.invalid && (reduceNegativeImpacts.dirty || reduceNegativeImpacts.touched)"
        class="field-error"
      >
        <mat-icon>warning</mat-icon>
        <div *ngIf="reduceNegativeImpacts.errors?.['required']">This field is required</div>
      </div>
      <div class="subtext">
        Example: Project phasing, providing landscape screening, fencing, buffering, erosion and sediment control,
        temporary or permanent drainage, etc.
      </div>
    </div>
    <div class="full-row">
      <label class="subheading2" for="proposal-map">Proposal Map / Site Plan</label>
      <div class="subtext">A visual representation of your proposal.</div>
      <app-file-drag-drop
        id="proposal-map"
        [uploadedFiles]="proposalMap"
        (uploadFiles)="attachFile($event, DOCUMENT.PROPOSAL_MAP)"
        (deleteFile)="onDeleteFile($event)"
        (openFile)="openFile($event)"
        [showErrors]="showErrors"
        [isRequired]="true"
      ></app-file-drag-drop>
    </div>
    <div class="full-row">
      <label class="subheading2" for="cross-section">Cross Sections</label>
      <div class="subtext">Include North-South and East-West cross sections</div>
      <app-info-banner>
        Please refer to <a>TODO: Removal of Soil</a> on the ALC website for more information
      </app-info-banner>
      <app-file-drag-drop
        id="cross-section"
        [uploadedFiles]="crossSections"
        (uploadFiles)="attachFile($event, DOCUMENT.CROSS_SECTIONS)"
        (deleteFile)="onDeleteFile($event)"
        (openFile)="openFile($event)"
        [showErrors]="showErrors"
        [isRequired]="true"
        [allowMultiple]="true"
      ></app-file-drag-drop>
    </div>
    <div class="full-row">
      <label class="subheading2" for="reclamation-plan">Reclamation Plan</label>
      <div class="subtext">
        The Reclamation Plan should be completed by a qualified Professional Agrologist and contain the area's
        agricultural capability assessment.
      </div>
      <app-info-banner>
        Please refer to <a>TODO: Removal of Soil</a> on the ALC website for more information
      </app-info-banner>
      <app-file-drag-drop
        id="reclamation-plan"
        [uploadedFiles]="reclamationPlan"
        (uploadFiles)="attachFile($event, DOCUMENT.RECLAMATION_PLAN)"
        (deleteFile)="onDeleteFile($event)"
        (openFile)="openFile($event)"
        [showErrors]="showErrors"
        [isRequired]="true"
        [allowMultiple]="true"
      ></app-file-drag-drop>
    </div>

    <div class="full-row">
      <label for="isExtractionOrMining">Is your proposal for aggregate extraction or placer mining?</label>
      <div>
        <mat-button-toggle-group
          class="input"
          (valueChange)="onChangeMiningExtraction($event)"
          id="isExtractionOrMining"
          formControlName="isExtractionOrMining"
        >
          <mat-button-toggle
            class="toggle-button"
            [ngClass]="{
              'error-outline':
                isExtractionOrMining.invalid && (isExtractionOrMining.dirty || isExtractionOrMining.touched)
            }"
            value="true"
            >Yes
          </mat-button-toggle>
          <mat-button-toggle
            class="toggle-button"
            [ngClass]="{
              'error-outline':
                isExtractionOrMining.invalid && (isExtractionOrMining.dirty || isExtractionOrMining.touched)
            }"
            value="false"
            >No
          </mat-button-toggle>
        </mat-button-toggle-group>
      </div>
    </div>

    <div class="full-row">
      <label for="isExtractionOrMining">
        Have you submitted a Notice of Work to the Ministry of Energy, Mines and Low Carbon Innovation (EMLI)?
      </label>
      <div class="subtext">If yes, please attach the Notice of Work in the section below.</div>
      <div>
        <mat-button-toggle-group
          class="input"
          (valueChange)="onChangeNoticeOfWork($event)"
          id="hasSubmittedNotice"
          formControlName="hasSubmittedNotice"
        >
          <mat-button-toggle
            class="toggle-button"
            [ngClass]="{
              'error-outline': hasSubmittedNotice.invalid && (hasSubmittedNotice.dirty || hasSubmittedNotice.touched)
            }"
            value="true"
            >Yes
          </mat-button-toggle>
          <mat-button-toggle
            class="toggle-button"
            [ngClass]="{
              'error-outline': hasSubmittedNotice.invalid && (hasSubmittedNotice.dirty || hasSubmittedNotice.touched)
            }"
            value="false"
            >No
          </mat-button-toggle>
        </mat-button-toggle-group>
      </div>
    </div>

    <div class="full-row">
      <label class="subheading2" for="noticeOfWork">Notice of Work</label>
      <app-info-banner>
        Please refer to <a>TODO: Removal of Soil</a> on the ALC website for more information
      </app-info-banner>
      <app-file-drag-drop
        id="noticeOfWork"
        [uploadedFiles]="noticeOfWork"
        (uploadFiles)="attachFile($event, DOCUMENT.NOTICE_OF_WORK)"
        (deleteFile)="onDeleteFile($event)"
        (openFile)="openFile($event)"
        [showErrors]="showErrors"
        [isRequired]="true"
        [disabled]="!requiresNoticeOfWork"
        [allowMultiple]="true"
      ></app-file-drag-drop>
    </div>
  </div>
</form>
<div class="button-container">
  <button *ngIf="!draftMode" (click)="onSaveExit()" mat-stroked-button color="accent">Save and Exit</button>
  <button *ngIf="draftMode" (click)="onSaveExit()" mat-stroked-button color="accent">Discard all Changes</button>
  <div>
    <button mat-stroked-button color="primary" (click)="onNavigateToStep(currentStep - 1)">
      Previous<span class="mobile-hidden"> Step</span>
    </button>
    <button mat-flat-button color="primary" (click)="onNavigateToStep(currentStep + 1)">
      Next<span class="mobile-hidden"> Step</span>
    </button>
  </div>
</div>
