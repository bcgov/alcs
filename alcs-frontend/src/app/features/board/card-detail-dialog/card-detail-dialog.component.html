<div mat-dialog-title>
  <div class="close">
    <button mat-icon-button [mat-dialog-close]="isApplicationDirty">
      <mat-icon>close</mat-icon>
    </button>
  </div>
  <div class="header-row">
    <div class="left">
      <h3 class="card-title">
        {{ application.fileNumber }} ({{ application.applicant }})
        <span
          class="center application-type"
          [ngStyle]="{
            backgroundColor: application.typeDetails.backgroundColor,
            color: application.typeDetails.textColor
          }"
        >
          {{ application.typeDetails.label }}
        </span>
      </h3>
    </div>
    <div>
      <button color="accent" [matMenuTriggerFor]="moreActions" mat-flat-button>More Actions â–¾</button>
      <mat-menu xPosition="before" #moreActions="matMenu">
        <button
          [mat-dialog-close]="isApplicationDirty"
          [routerLink]="['application', application.fileNumber]"
          mat-menu-item
        >
          View Detail
        </button>
        <button
          [mat-dialog-close]="isApplicationDirty"
          [routerLink]="['application', application.fileNumber]"
          mat-menu-item
        >
          Add Info Request
        </button>
        <button
          [mat-dialog-close]="isApplicationDirty"
          [routerLink]="['application', application.fileNumber, 'site-visit-meeting']"
          mat-menu-item
        >
          Add Site Visit / Meeting
        </button>
      </mat-menu>
    </div>
  </div>
  <div>
    <span class="region">{{ application.localGovernment.name }} - {{ application.regionDetails.label }} Region</span>
  </div>
  <div class="header-row">
    <div class="left">
      <div class="body1-text left time-tracking">
        <div *ngIf="!application.paused"><span class="dot"></span>Active</div>
        <div *ngIf="application.paused"><span class="dot paused"></span>Paused</div>
        <div
          matTooltip="Active Days"
          class="card-active-days"
          [ngClass]="{
            'inactive-timer': application.paused
          }"
        >
          <mat-icon class="icon">calendar_month</mat-icon>
          {{ application.activeDays }}
        </div>
        <div
          matTooltip="Paused Days"
          class="card-paused-days"
          [ngClass]="{
            'inactive-timer': !application.paused
          }"
        >
          <mat-icon class="icon">pause</mat-icon>
          {{ application.pausedDays }}
        </div>
      </div>
    </div>
    <div style="margin-right: -16px" class="right">
      <button matTooltip="Move Board" [matMenuTriggerFor]="moveMenu" mat-icon-button>
        <mat-icon>move_down</mat-icon>
      </button>
      <mat-menu class="move-board-menu" xPosition="before" #moveMenu="matMenu">
        <button class="board-menu-item" (click)="onBoardSelected(board)" *ngFor="let board of boards" mat-menu-item>
          <span class="favourite-board-icon-container"
            ><mat-icon *ngIf="board.isFavourite" class="favourite-board-icon">star</mat-icon>
          </span>
          <span>{{ board.title }}</span>
          <span *ngIf="application.board === board.code"><mat-icon class="selected-board-icon">check</mat-icon></span>
        </button>
      </mat-menu>
      <button
        [matTooltip]="application.card.highPriority ? 'Remove Priority' : 'Add Priority'"
        class="toggle-priority"
        (click)="onTogglePriority()"
        mat-icon-button
      >
        <div
          class="priority"
          [ngClass]="{
            'filled-priority': application.card.highPriority,
            'empty-priority': !application.card.highPriority
          }"
        ></div>
      </button>
    </div>
  </div>
</div>
<mat-dialog-content>
  <div class="select-container">
    <ng-select
      class="card-type"
      [items]="boardStatuses"
      placeholder="Workflow Stage"
      bindLabel="label"
      bindValue="statusCode"
      [clearable]="false"
      [(ngModel)]="selectedApplicationStatus"
      (change)="onStatusSelected($event)"
    >
      <ng-template ng-option-tmp let-item="item">
        <span [innerHTML]="item.label"> </span>
      </ng-template>
    </ng-select>
    <ng-select
      class="card-assignee"
      [items]="$users | async"
      placeholder="Assignee"
      bindLabel="name"
      bindValue="name"
      [(ngModel)]="selectedAssigneeName"
      [searchFn]="filterAssigneeList"
      (change)="onAssigneeSelected($event)"
    >
      <ng-template ng-option-tmp let-item="item" let-search="searchTerm">
        <div class="assignee-card-body">
          <p [ngOptionHighlight]="search" class="assignee-card-name">{{ item.name }}</p>
          <p class="assignee-card-email" [ngOptionHighlight]="search">{{ item.email }}</p>
        </div>
      </ng-template>
    </ng-select>
  </div>
  <div class="subtasks-wrapper">
    <app-subtasks [cardUuid]="application.card.uuid"></app-subtasks>
  </div>
  <div class="card-comments-wrapper">
    <app-comments [cardUuid]="application.card.uuid" [fileNumber]="application.fileNumber"></app-comments>
  </div>
</mat-dialog-content>
