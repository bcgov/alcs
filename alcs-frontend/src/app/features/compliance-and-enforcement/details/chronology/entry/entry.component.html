<div class="entry" [class.is-draft]="entry?.isDraft">
  <form [formGroup]="form">
    <div class="date">
      @if (entry?.isDraft) {
        <mat-form-field appearance="outline">
          <mat-label>Date</mat-label>
          <input
            matInput
            (click)="datePicker.open()"
            [matDatepicker]="datePicker"
            name="date-submitted"
            formControlName="date"
            />
          <mat-datepicker-toggle matSuffix [for]="datePicker"></mat-datepicker-toggle>
          <mat-datepicker #datePicker type="date"></mat-datepicker>
        </mat-form-field>
        @if (showErrors && date.errors) {
          <div>
            @if (date.errors['required']) {
              <app-error-message message="This field is required"></app-error-message>
            }
            @if (date.errors['dateInUse']) {
              <app-error-message message="Date is already in use"></app-error-message>
            }
          </div>
        }
      } @else {
        <div>{{ entry?.date | date: 'yyyy-MMM-dd' }}</div>
      }

    </div>

    <div class="main">
      @if (!entry?.isDraft) {
        <button
          type="button"
          class="edit-button"
          [disabled]="!entry?.uuid || editDisabled"
          (click)="edit.emit(entry?.uuid!)"
          >
          <mat-icon>edit</mat-icon>
        </button>
      }

      @if (entry?.isDraft) {
        <mat-form-field appearance="outline">
          <mat-label>Author</mat-label>
          <mat-select panelClass="author-list-panel" [formControl]="authorDropdown">
            @for (author of authors; track author) {
              <mat-option [value]="author.uuid">
                {{ author.prettyName }}
              </mat-option>
            }
          </mat-select>
        </mat-form-field>
      } @else {
        <strong>{{ entry?.author?.prettyName }}</strong>
      }


      @if (entry?.isDraft) {
        <div class="description-wrapper">
          <mat-form-field appearance="outline">
            <mat-label>Description</mat-label>
            <textarea matInput formControlName="description" rows="3"></textarea>
          </mat-form-field>
          @if (showErrors && description.errors) {
            <div>
              @if (description.errors['required']) {
                <app-error-message
                  message="This field is required"
                ></app-error-message>
              }
            </div>
          }
        </div>
      } @else {
        <div class="description-view">{{ entry?.description }}</div>
      }


      @if (entry?.isDraft) {
        <div class="c-and-e-action-list">
          <strong>C&E Action:</strong> <span class="no-data"> No Data</span>
        </div>
      }

      @if (entry?.isDraft) {
        <div class="add-component-actions">
          <button mat-stroked-button color="primary" type="button" [disabled]="!entry?.uuid" class="add-action-button">
            + ALC C&E Action
            <mat-icon>arrow_drop_down</mat-icon>
          </button>
          <button
            mat-stroked-button
            type="button"
            [disabled]="!entry?.uuid"
            (click)="addCorrespondence.emit(entry?.uuid!)"
            class="add-correspondence-button"
            >
            + Correspondence
          </button>
        </div>
      }

      <!-- Documents -->
      <ng-content></ng-content>

      @if (entry?.isDraft) {
        <div class="actions">
          <button
            mat-stroked-button
            color="warn"
            type="button"
            [disabled]="!entry?.uuid"
            (click)="delete.emit(entry?.uuid!)"
            >
            Delete
          </button>
          <button
            mat-flat-button
            color="primary"
            type="button"
            [disabled]="!entry?.uuid"
            (click)="onCompleteButtonClick()"
            >
            Complete
          </button>
        </div>
      }
    </div>
  </form>
</div>
